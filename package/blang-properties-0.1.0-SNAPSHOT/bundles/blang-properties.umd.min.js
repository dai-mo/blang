!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("@angular/forms"),require("seamless-immutable"),require("@angular/core"),require("@angular/common"),require("primeng/primeng"),require("primeng/components/common/messageservice"),require("@angular/material/slider"),require("@angular/flex-layout")):"function"==typeof define&&define.amd?define("@blang/properties",["exports","@angular/forms","seamless-immutable","@angular/core","@angular/common","primeng/primeng","primeng/components/common/messageservice","@angular/material/slider","@angular/flex-layout"],i):i((e.blang=e.blang||{},e.blang.properties={}),e.ng.forms,e.seamlessImmutable,e.ng.core,e.ng.common,e.primeng,e.messageservice,e.ng.material.slider,e.ng["flex-layout"])}(this,function(e,n,o,i,t,l,s,r,a){"use strict";var d={STRING:0,NUMBER:1,BOOLEAN:2,UNKNOWN:3};d[d.STRING]="STRING",d[d.NUMBER]="NUMBER",d[d.BOOLEAN]="BOOLEAN",d[d.UNKNOWN]="UNKNOWN";var u={UNKNOWN:0,TEXT:1,BOOLEAN:2,LIST:3,RANGE:4};u[u.UNKNOWN]="UNKNOWN",u[u.TEXT]="TEXT",u[u.BOOLEAN]="BOOLEAN",u[u.LIST]="LIST",u[u.RANGE]="RANGE";var f=function(e,i,t){this.value=e,this.displayName=i,this.description=this.description},p={ClosedField:0,OpenField:100};p[p.ClosedField]="ClosedField",p[p.OpenField]="OpenField";var c=function(){function e(e,i,t,n,o,l,s,r,a,d){void 0===t&&(t=""),void 0===n&&(n=""),void 0===o&&(o=[]),void 0===l&&(l=""),void 0===s&&(s=!1),void 0===r&&(r=!1),void 0===a&&(a=p.ClosedField),void 0===d&&(d=!1),this.level=p.ClosedField,this.valueIndex=0,this.active=!1,this.name=e,this.label=i,this.description=t,this.defaultValue=n,this.possibleValues=o,this.value=l,this.isRange=this.isEditable=s,this.isRequired=r,this.level=a,this.isRange=d,this.resolveValue()}return e.fieldType=function(e){switch(e){case"STRING":return d.STRING;case"NUMBER":return d.NUMBER;case"BOOLEAN":return d.BOOLEAN;default:return d.UNKNOWN}},e.prototype.resolveValue=function(){var i=this;0<this.possibleValues.length&&(this.possibleValues=this.possibleValues.filter(function(e){return""!==e.value}),this.selectItems=this.possibleValues.map(function(e){return{label:e.displayName,value:e.value}}),this.valueIndex=this.possibleValues.findIndex(function(e){return e.value===i.value}))},e.prototype.valueToString=function(e){return"string"==typeof e?e:"number"==typeof e?e.toString():"boolean"==typeof e?e.toString():undefined},e.prototype.updateValue=function(e){this.value=e},e.prototype.setCollector=function(e){this.collector=e},e.prototype.fieldUIType=function(){return 0<this.possibleValues.length?this.isRange?u.RANGE:u.LIST:"string"==typeof this.value?u.TEXT:"boolean"==typeof this.value?u.BOOLEAN:u.UNKNOWN},e.prototype.isHiddenField=function(){return this.level===p.ClosedField},e}(),m=function(){function e(e,i,t,n,o){void 0===i&&(i=[]),void 0===t&&(t=function(e,i){}),void 0===n&&(n=!1),void 0===o&&(o=function(e){}),this.fields=[],this.active=!1,this.label=e,i===undefined?this.fields=[]:this.fields=i,this.isReactive=n,this.form=this.toFormGroup(this.fields),this.submit=o,this.invalid=t}return e.prototype.add=function(e){this.fields.push(e)},e.prototype.setCollector=function(e){this.collector=e},e.prototype.isValid=function(){var e,i,t=!0;try{for(var n=function(e){var i="function"==typeof Symbol&&e[Symbol.iterator],t=0;return i?i.call(e):{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}}}(Object.keys(this.form.controls)),o=n.next();!o.done;o=n.next()){var l=o.value,s=this.form.controls[l];s.invalid&&(this.invalid(l,s.value),t=!1)}}catch(r){e={error:r}}finally{try{o&&!o.done&&(i=n["return"])&&i.call(n)}finally{if(e)throw e.error}}return t},e.prototype.doSubmit=function(e){this.isValid()&&e(this.collector())},e.prototype.doReactiveSubmit=function(){this.doSubmit(this.submit)},e.prototype.control=function(e){return e.isRequired?new n.FormControl(e.value,n.Validators.required):new n.FormControl(e.value)},e.prototype.toFormGroup=function(e){var i=this,t={};return e.filter(function(e){return e.isEditable}).forEach(function(e){t[e.name]=i.control(e)}),new n.FormGroup(t)},e}(),h={OK:0,WARNING:1};h[h.OK]="OK",h[h.WARNING]="WARNING";var v={THREED_OBJECT:0,VIEWER_SETTINGS:1};v[v.THREED_OBJECT]="THREED_OBJECT",v[v.VIEWER_SETTINGS]="VIEWER_SETTINGS";var g=function(e,i,t,n,o,l){void 0===n&&(n=h.OK),void 0===o&&(o=[]),void 0===l&&(l=[]),this.id=e,this.name=i,this.description=t,this.status=n,this.fieldGroups=o,this.specificFields=l},y=function(){function e(e){void 0===e&&(e=!1),this.items=[],this.hideCancel=!1,this.showFirstItemOnly=!1,this.showFirstItemOnly=e}return e.prototype.list=function(){return this.items},e.prototype.find=function(i){return this.items.find(function(e){return e.id===i})},e.prototype.fieldGroups=function(e){return this.find(e).fieldGroups},e.prototype.selectedItemFieldGroups=function(){return this.fieldGroups(this.selectedItemId)},e.prototype.specificFields=function(e){return this.find(e).specificFields},e.prototype.selectedItemSpecificFields=function(){return this.specificFields(this.selectedItemId)},e.prototype.hasItems=function(){return 0<this.items.length},e.prototype.isSelected=function(){return this.selectedItemId!==undefined||this.showFirstItemOnly},e.prototype.select=function(e){this.selectedItemId=e;var i=this.selectedItemFieldGroups();if(i!==undefined&&0<i.length)i[0].active=!0;else{var t=this.selectedItemSpecificFields();t!==undefined&&0<t.length&&(t[0].active=!0)}},e.prototype.finalise=function(){var e=this.selectedItemSpecificFields(),i=this.selectedItemFieldGroups(),t=!0;if(i.forEach(function(e){t=e.isValid()}),t){var n=o.from({});e!==undefined&&0<e.length&&e.forEach(function(e){n=n.merge(e.collector())}),i!==undefined&&0<i.length&&i.forEach(function(e){n=n.merge(e.collector())}),this.postFinalise(n)}},e}(),b=function(){function e(){this.isVisible=!1}return e.prototype.ngOnInit=function(){},e}();b.decorators=[{type:i.Component,args:[{selector:"app-item-list-dialog",template:'<p-dialog *ngIf="isVisible" [(visible)]="isVisible" class="dialog-container" [header]="dialogHeader" modal="modal" [closable]="false"\n  [responsive]="true">\n  <input [style.display]="\'none\'" />\n  <app-item-list-panel class="dialog-panel" [itemConf]="dialogItemConf" [finaliseLabel]="finaliseLabel"></app-item-list-panel>\n</p-dialog>\n',styles:[""]}]}],b.ctorParameters=function(){return[]},b.propDecorators={isVisible:[{type:i.Input}],dialogHeader:[{type:i.Input}],dialogItemConf:[{type:i.Input}],finaliseLabel:[{type:i.Input}]};var I=function(){function e(){this.itemStatus=h,this.items=[]}return e.prototype.ngOnInit=function(){var i=this;if(this.itemConf!==undefined){var e=void 0;this.itemConf.showFirstItemOnly?(e=[this.itemConf.items[0]],this.select(this.itemConf.items[0].id)):e=this.itemConf.list(),e.forEach(function(e){return i.items.push({label:e.name,value:{id:e.id,status:e.status}})})}},e.prototype.select=function(e){this.itemConf!==undefined&&(this.itemConf.select(e),this.selectedItemFieldGroups=this.itemConf.fieldGroups(e),this.selectedItemSpecificFields=this.itemConf.specificFields(e))},e.prototype.finalise=function(){this.itemConf!==undefined&&this.itemConf.finalise()},e.prototype.cancel=function(){this.itemConf.cancel()},e}();I.decorators=[{type:i.Component,args:[{selector:"app-item-list-panel",template:'<div fxLayout="row" fxLayoutGap="15px">\n  <div *ngIf="!itemConf.showFirstItemOnly" fxFlex="0 1 33%">\n    <p-listbox class="item-list" [options]="items" [(ngModel)]="selectedItemValue" (onChange)="select($event.value.id)" filter="filter"\n      [style]="{\'width\': \'100%\'}" [listStyle]="{\'min-height\': \'300px\', \'max-height\': \'300px\'}">\n    </p-listbox>\n  </div>\n  <div *ngIf="itemConf.isSelected()" fxFlex="0 1 66%">\n    <p-tabView [style]="{\'height\': \'340px\'}">\n      <p-tabPanel *ngFor="let fieldGroup of itemConf.selectedItemFieldGroups()" [header]="fieldGroup.label" [selected]="fieldGroup.active">\n        <app-fields-panel [fieldGroup]="fieldGroup"></app-fields-panel>\n      </p-tabPanel>\n    </p-tabView>\n  </div>\n</div>\n<p-footer>\n  <div class="ui-dialog-footer ui-widget-content ui-helper-clearfix footer">\n    <button pButton type="button" (click)="finalise()" [disabled]="!itemConf.isSelected()" label="{{finaliseLabel}}">\n    </button>\n    <button pButton type="button" (click)="cancel()" [hidden]="itemConf.hideCancel" label="Cancel">\n    </button>\n  </div>\n</p-footer>\n',styles:[".footer{border:none;padding:2px}"]}]}],I.ctorParameters=function(){return[]},I.propDecorators={itemConf:[{type:i.Input}],finaliseLabel:[{type:i.Input}]};var N=function(){function e(){this.fieldUIType=u,this.collect=function(){var i=this,t=o.from(this.fieldGroup.form.value);return this.fields.filter(function(e){return e.isRange}).forEach(function(e){return t=t.set(e.name,e.possibleValues[i.fieldGroup.form.value[e.name]].value)}),t}.bind(this)}return e.prototype.ngOnInit=function(){this.fields=this.fieldGroup.fields,this.fieldGroup.setCollector(this.collect)},e.prototype.onUpdate=function(){this.fieldGroup.isReactive&&this.fieldGroup.doReactiveSubmit()},e.prototype.onRangeUpdate=function(e,i){this.fieldGroup.isReactive&&this.onUpdate()},e.prototype.isValid=function(e){return!e.isEditable||(e.isRequired?this.fieldGroup.form.controls[e.name].valid:void 0)},e}();N.decorators=[{type:i.Component,args:[{selector:"app-fields-panel",template:'<div>\n  <form [formGroup]="fieldGroup.form">\n    <div *ngFor="let field of fields" [ngSwitch]="field.fieldUIType()" class="value-padding">\n      <div class="ui-g-4">\n        <label [attr.for]="field.name">{{field.label}}</label>\n      </div>\n      <div>\n        <div class="ui-g" *ngSwitchCase="fieldUIType.TEXT">\n          <div *ngIf="!(field.isEditable)" class="ui-g-8">\n            <span [id]="field.name">{{field.value}}</span>\n          </div>\n          <div *ngIf="field.isEditable" class="ui-g-8">\n            <span class="md-inputfield">\n              <input [id]="field.name" pInputText type="text" class="value ui-inputtext ui-corner-all ui-state-default ui-widget" [formControlName]="field.name"\n                [(ngModel)]="field.value" />\n            </span>\n          </div>\n        </div>\n        <div class="ui-g" *ngSwitchCase="fieldUIType.BOOLEAN">\n          <div *ngIf="!(field.isEditable)" class="ui-g-8">\n            <span [id]="field.name">{{field.value ? \'true\' : \'false\'}}</span>\n          </div>\n          <div *ngIf="field.isEditable" class="ui-g-8">\n            <p-checkbox [id]="field.name" [(ngModel)]="field.value" binary="true" [formControlName]="field.name" (onChange)=onUpdate()>\n            </p-checkbox>\n          </div>\n        </div>\n        <div class="ui-g" *ngSwitchCase="fieldUIType.LIST">\n          <div *ngIf="!(field.isEditable)" class="ui-g-8">\n            <span [id]="field.name">{{field.value}}</span>\n          </div>\n          <div *ngIf="field.isEditable" class="ui-g-8">\n            <p-dropdown [id]="field.name" [style]="{\'width\':\'250px\'}" [options]="field.selectItems" [(ngModel)]="field.value" [formControlName]="field.name"\n              (onChange)=onUpdate() placeholder="Select ..." showClear="false"></p-dropdown>\n          </div>\n        </div>\n        <div class="ui-g" *ngSwitchCase="fieldUIType.RANGE">\n          <div *ngIf="!(field.isEditable)" class="ui-g-8">\n            <span [id]="field.name">{{field.value}}</span>\n          </div>\n          <div *ngIf="field.isEditable" class="ui-g-8">\n            <mat-slider [id]="field.name" [(ngModel)]="field.valueIndex" class="value" (change)="onRangeUpdate($event, field)" [step]="1"\n              [min]="0" [max]="field.possibleValues.length - 1" [tick-interval]="1" [formControlName]="field.name"></mat-slider>\n            <div class="value">\n              <span>{{field.possibleValues[field.valueIndex].value}}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </form>\n</div>\n',styles:[".value{width:250px;text-align:center}.value-padding{padding:5px}.ng-invalid{border-color:red}.ng-valid{border-color:#000}"]}]}],N.ctorParameters=function(){return[]},N.propDecorators={fieldGroup:[{type:i.Input}]};var E=function(){};E.decorators=[{type:i.NgModule,args:[{imports:[t.CommonModule,l.TabViewModule,l.ButtonModule,n.FormsModule,n.ReactiveFormsModule,l.CheckboxModule,l.ListboxModule,l.DropdownModule,l.SliderModule,l.DialogModule,r.MatSliderModule,a.FlexLayoutModule],providers:[s.MessageService],declarations:[N,I,b],exports:[N,I,b]}]}],E.ctorParameters=function(){return[]},e.PropertiesModule=E,e.FieldType=d,e.FieldUIType=u,e.PossibleValue=f,e.FieldVisibilityLevel=p,e.Field=c,e.FieldGroup=m,e.ItemStatus=h,e.ItemType=v,e.Item=g,e.ItemConf=y,e.ɵc=b,e.ɵa=N,e.ɵb=I,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=blang-properties.umd.min.js.map
